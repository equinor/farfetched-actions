name: üîçÔ∏è PR Name Validation
author: "Andreas Dukstad & Arne Kristian Jansen"
description: "This action will validate the name of a PR, ensuring it follows the expected naming rules."
inputs:
    github-token:
        description: "The GitHub token to use for authentication."
        required: true

    failed-pr-label:
        description: "The label to apply to the PR if it fails the validation."
        required: false
        default: "invalid_PR_name"

runs:
    using: "composite"
    steps:
        - uses: actions/checkout@v2
        - name: Checkout current PR
          shell: bash
          env:
              GITHUB_TOKEN: ${{ inputs.github-token }}
          run: gh pr checkout $GITHUB_HEAD_REF

        - name: Create Label (if not exists)
          continue-on-error: true
          shell: bash
          env:
              GITHUB_TOKEN: ${{ inputs.github-token }}
          run: gh label create ${{ inputs.failed-pr-label }}

        # For full configuration capabilities of the linter, see: https://github.com/marketplace/actions/semantic-pull-request
        - name: Lint pull request title
          uses: amannn/action-semantic-pull-request@91682d013dea3ff257520b9b68c9cb93ced4fe9b # The SHA refers to v4.5
          env:
              GITHUB_TOKEN: ${{ inputs.github-token }}

        - name: Remove label
          shell: bash
          env:
              GITHUB_TOKEN: ${{ inputs.github-token }}
          run: gh pr edit --remove-label ${{ inputs.failed-pr-label }}

        - name: Add label
          if: ${{ failure() }}
          shell: bash
          env:
              GITHUB_TOKEN: ${{ inputs.github-token }}
          run: gh pr edit --add-label ${{ inputs.failed-pr-label }}
